filter{
  if [fileset][module] == "iis" {
    if [fileset][name] == "access" {
      grok {
        match => { "message" => "%{TIMESTAMP_ISO8601:log_timestamp} %{WORD:iisSite} %{IPORHOST:server_ip} %{WORD:method} %{URIPATH:url} %{NOTSPACE:querystring} %{NUMBER:port} %{NOTSPACE:username} %{IPORHOST:client_ip} %{NOTSPACE:useragent} %{NOTSPACE:referer} %{NUMBER:response} %{NUMBER:subresponse} %{NUMBER:scstatus} %{NUMBER:server_to_client_bytes:int} %{NUMBER:client_to_server_bytes:int} %{NUMBER:timetaken:int}"}
        pattern_definitions => {
          "GREEDYMULTILINE"=> "(.|\n)*"
        }
        remove_field => "message"
      }
      date {
        match => [ "log_timestamp", "ISO8601" ]
        target => "@timestamp"
      }
      geoip {
        source => "server_ip"
      }
    }
  }
}
